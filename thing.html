<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Thing</title>
		<script src="cameraAndRenderer.js"></script>
		<script src="thingsAndTheirPhysics.js"></script>
		<script src="catThing.js"></script>
	</head>
	<body>
		<img id="playerImage" src="kat.png" hidden>
		<div>
			<canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;"></canvas>
		</div>
		<div>
			<button onclick="playerThing.physicsModule.velocityY=10">Forward</button>
			<button onclick="playerThing.physicsModule.velocityY=-10">Backward</button>
			<button onclick="playerThing.physicsModule.velocityX=-10">Left</button>
			<button onclick="playerThing.physicsModule.velocityX=10">Right</button>
			<button onclick="playerThing.physicsModule.velocityZ=5">Jump</button>
			<br>
			<br>
			<button onclick="changeCamera()">Change camera</button>
			<button onclick="renderer.camera.rotationZ -= 5">Turn camera left</button>
			<button onclick="renderer.camera.rotationZ += 5">Turn camera right</button>
		</div>
		<script>
			fps = 60;

			var canvas = document.getElementById("myCanvas");

			var objects = generateBlocks();	

	
			playerThing = new CatThing(0, 2, 0, 0.5, 1, 1);
			playerThing.image = document.getElementById('playerImage');
			physicsModuleForPlayerThing = new PhysicsModuleForObject(playerThing);
			physicsModuleForPlayerThing.drag = 0.15;

			var cameras = [];
			var staticCamera = new Camera(0, 0, 1.6);
			var chaseCamera = new Camera(0, 0, 1.6);
			chaseCamera.rotationZ = 0;
			chaseCamera.fieldOfView = 90;
			playerThing.attachedCamera = chaseCamera;
			cameras.push(staticCamera, chaseCamera);

			objects.push(playerThing);

			var renderer = new Renderer(canvas, objects, chaseCamera);
			var currentCamera = 1;

			setInterval(function() {
				renderer.render();

				//The physics part
				objects.forEach((object) => {
					object.calculateNewPosition();
				});

			}, 1000/fps);

			function changeCamera() {
				if (currentCamera < cameras.length - 1) {
					currentCamera++;
				} else {
					currentCamera = 0;
				}

				renderer.camera = cameras[currentCamera];
			}

			function generateBlocks()
			{
				var things = [];

				var thing1 = new Thing(0, 30, 10, 2, 2, 10);
				var physicsModuleForThing1 = new PhysicsModuleForObject(thing1);		

				var thing2 = new Thing(-10, 20, 5, 2, 2, 5);
				var physicsModuleForThing2 = new PhysicsModuleForObject(thing2);
				physicsModuleForThing2.velocityZ = 5;
				physicsModuleForThing2.velocityY = -10;
				physicsModuleForThing2.velocityX = 10;

				var thing3 = new Thing(-20, 20, 5, 0.1, 2, 5);
				var physicsModuleForThing3 = new PhysicsModuleForObject(thing3);

				things.push(thing1, thing2, thing3);

				var step = 360/12;
				var currentDegree = 15;
				var radius = 10;
				while (currentDegree < 360) {
					let posX = radius * Math.sin(currentDegree * Math.PI / 180);
					let posY = radius * Math.cos(currentDegree * Math.PI / 180);
					let circleThing = new Thing(posX, 30 + posY, 5, 2, 2, 3);
					let physicsForCircleThing = new PhysicsModuleForObject(circleThing);
					things.push(circleThing);
					currentDegree += step;
				}

				return things;
			}
		</script>
	</body>
</html>